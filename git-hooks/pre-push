#!/bin/bash

LOG_FILE="$HOME/git_commit_log.txt"
DISCORD_WEBHOOK_URL="https://discord.com/api/webhooks/YOUR_WEBHOOK_ID/YOUR_WEBHOOK_TOKEN"

# Láº¥y thÃ´ng tin ngÆ°á»i push, nhÃ¡nh, remote repo vÃ  timestamp
TIMESTAMP=$(date "+%Y-%m-%d %H:%M:%S")
USER_NAME=$(git config user.name)
BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)
REMOTE_URL=$(git remote get-url origin)

# Ghi log push vÃ o file
echo "ğŸš€ [$TIMESTAMP] User: $USER_NAME | Pushed branch '$BRANCH_NAME' to remote: $REMOTE_URL" >> "$LOG_FILE"
echo "-----------------------------------" >> "$LOG_FILE"

# Kiá»ƒm tra náº¿u webhook bá»‹ lá»—i
if [ -z "$DISCORD_WEBHOOK_URL" ]; then
    echo "âš ï¸ Discord webhook chÆ°a Ä‘Æ°á»£c cáº¥u hÃ¬nh!"
    exit 1
fi

# Táº¡o payload JSON gá»­i lÃªn Discord
PAYLOAD=$(jq -n --arg timestamp "$TIMESTAMP" \
                    --arg user "$USER_NAME" \
                    --arg branch "$BRANCH_NAME" \
                    --arg remote "$REMOTE_URL" \
                    '{content: ("ğŸš€ *New push detected!* \nğŸ‘¤ User: " + $user + "\nğŸ“… Time: " + $timestamp + "\nğŸŒ¿ Branch: " + $branch + "\nğŸ”— Remote: " + $remote)}')

# Gá»­i thÃ´ng bÃ¡o Ä‘áº¿n Discord
curl -H "Content-Type: application/json" -d "$PAYLOAD" "$DISCORD_WEBHOOK_URL"
