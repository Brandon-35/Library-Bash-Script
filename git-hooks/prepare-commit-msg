#!/bin/bash

# ==============================================================
#  ğŸš€ GIT COMMIT MESSAGE HOOK (Conventional Commits)
#  ğŸ”¹ Kiá»ƒm tra commit message trÆ°á»›c khi commit
#  ğŸ”¹ NgÄƒn cháº·n commit sai format, giÃºp Git log dá»… Ä‘á»c & nháº¥t quÃ¡n
# ==============================================================

# âœ… Cáº¥u trÃºc commit há»£p lá»‡:
# type(scope): subject
# <body> (optional)
# <footer> (optional)
#
# ğŸ”¹ Trong Ä‘Ã³:
# - `type`  (Báº¯t buá»™c): Loáº¡i commit (feat, fix, chore, ...)
# - `scope` (TÃ¹y chá»n): Pháº¡m vi thay Ä‘á»•i (auth, api, database, ...)
# - `subject` (Báº¯t buá»™c): MÃ´ táº£ ngáº¯n gá»n vá» thay Ä‘á»•i (viáº¿t á»Ÿ thá»ƒ má»‡nh lá»‡nh)
#
# ğŸ“Œ VÃ­ dá»¥ commit há»£p lá»‡:
# feat(auth): implement JWT authentication
# fix(cart): fix checkout button not working
# docs(readme): update installation instructions

# ==============================================================
#  ğŸ”¹ Danh sÃ¡ch cÃ¡c loáº¡i commit (Type) + Ã nghÄ©a ğŸ”¹
# ==============================================================

COMMIT_TYPES=(
    "feat: âœ¨ ThÃªm tÃ­nh nÄƒng má»›i (Add a new feature)"
    "fix: ğŸ› Sá»­a lá»—i bug (Fix a bug)"
    "docs: ğŸ“š Cáº­p nháº­t tÃ i liá»‡u (Documentation changes)"
    "style: ğŸ¨ Chá»‰nh sá»­a format code (Code style, formatting)"
    "refactor: ğŸ”§ Cáº£i thiá»‡n code mÃ  khÃ´ng thay Ä‘á»•i logic (Refactoring code)"
    "test: ğŸ§ª ThÃªm hoáº·c chá»‰nh sá»­a test cases (Adding tests)"
    "chore: ğŸ”¨ Thay Ä‘á»•i cáº¥u hÃ¬nh, cÃ´ng cá»¥ (Build tasks, dependencies)"
    "build: ğŸ— Thay Ä‘á»•i build process, dependencies (Build system changes)"
    "perf: âš¡ Cáº£i thiá»‡n hiá»‡u nÄƒng (Performance improvements)"
    "ci: ğŸ¤– Cáº¥u hÃ¬nh CI/CD (CI configuration changes)"
    "revert: âª HoÃ n tÃ¡c commit trÆ°á»›c Ä‘Ã³ (Revert changes)"
)

# ==============================================================
#  ğŸ”¹ Kiá»ƒm tra commit message trÆ°á»›c khi commit ğŸ”¹
# ==============================================================

commit_msg_file="$1"

# Kiá»ƒm tra náº¿u commit lÃ  merge tá»± Ä‘á»™ng, bá» qua kiá»ƒm tra format
if grep -qE "^Merge branch" "$commit_msg_file"; then
    echo "ğŸ”„ Merge commit detected, skipping commit message validation."
    exit 0
fi

# Äá»c commit message tá»« file (cÃ¢u lá»‡nh git commit -m "..." sáº½ ghi vÃ o Ä‘Ã¢y)
commit_msg=$(head -n1 "$commit_msg_file")

echo "ğŸ” Kiá»ƒm tra commit message: '$commit_msg'"

# Kiá»ƒm tra commit cÃ³ Ä‘Ãºng format khÃ´ng
if ! echo "$commit_msg" | grep -Eq "^(feat|fix|docs|style|refactor|test|chore|build|perf|ci|revert)(\([a-zA-Z0-9/_-]+\))?: .+"; then
    echo -e "\nâŒ  Lá»–I: Commit message khÃ´ng Ä‘Ãºng format!"
    echo -e "âœ…  HÃ£y dÃ¹ng Ä‘á»‹nh dáº¡ng: type(scope): subject\n"
    
    echo "ğŸ”¹ CÃ¡c loáº¡i commit há»£p lá»‡:"
    for commit_type in "${COMMIT_TYPES[@]}"; do
        echo -e "  - $commit_type"
    done
    
    echo -e "\nğŸ“Œ VÃ­ dá»¥ commit Ä‘Ãºng:"
    echo "  feat(auth): implement JWT authentication"
    echo "  fix(cart): fix checkout button not working"
    echo "  docs(readme): update installation instructions"

    exit 1
fi

# Náº¿u commit Ä‘Ãºng format, cho phÃ©p tiáº¿p tá»¥c
exit 0
